<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Regardez TM1 en direct, découvrez nos programmes et restez connectés avec l'actualité malienne">
  <title>TM1 - Live Streaming | Chaîne nationale du Mali</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #00ffcc;
      --secondary-color: #0066cc;
      --dark-bg: #000000;
      --darker-bg: #1a1a1a;
      --light-text: #ffffff;
      --gray-text: #aaaaaa;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--dark-bg), var(--darker-bg));
      color: var(--light-text);
      line-height: 1.6;
    }

    header {
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.7);
      position: relative;
      z-index: 10;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    header img {
      width: 150px;
      max-width: 80%;
    }

    h1 {
      font-size: 1.8rem;
      color: var(--primary-color);
      margin: 10px 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .current-time {
      font-size: 1rem;
      color: var(--gray-text);
      margin-bottom: 10px;
    }

    .current-program {
      background-color: rgba(0, 255, 204, 0.1);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-bottom: 15px;
      border: 1px solid var(--primary-color);
    }

    #video-container {
      position: relative;
      max-width: 1000px;
      margin: 20px auto;
      border: 4px solid var(--primary-color);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0, 255, 204, 0.2);
    }

    video {
      width: 100%;
      height: auto;
      background-color: #000;
    }

    #loader {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.2rem;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px 30px;
      border-radius: 8px;
      display: none;
      z-index: 5;
    }

    .video-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .control-btn {
      padding: 10px 20px;
      background-color: var(--primary-color);
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-btn:hover {
      background-color: #00e6b8;
      transform: translateY(-2px);
    }

    .control-btn.secondary {
      background-color: transparent;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }

    .control-btn.secondary:hover {
      background-color: rgba(0, 255, 204, 0.1);
    }

    .program-guide {
      max-width: 1000px;
      margin: 30px auto;
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
    }

    .program-guide h2 {
      color: var(--primary-color);
      margin-top: 0;
      border-bottom: 1px solid var(--primary-color);
      padding-bottom: 10px;
    }

    .program-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
    }

    .program-item {
      background-color: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 8px;
      transition: transform 0.3s ease;
    }

    .program-item:hover {
      transform: translateY(-5px);
      background-color: rgba(0, 255, 204, 0.1);
    }

    .program-time {
      color: var(--primary-color);
      font-weight: bold;
    }

    .program-title {
      font-weight: 600;
      margin: 5px 0;
    }

    .program-desc {
      font-size: 0.85rem;
      color: var(--gray-text);
    }

    .socials {
      margin: 30px 0;
    }

    .socials h3 {
      color: var(--primary-color);
      margin-bottom: 15px;
    }

    .social-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .social-link {
      color: var(--light-text);
      background-color: rgba(255, 255, 255, 0.1);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .social-link:hover {
      transform: scale(1.1);
      background-color: var(--primary-color);
      color: #000;
    }

    .contact-info {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
    }

    .contact-info h3 {
      color: var(--primary-color);
      margin-top: 0;
    }

    .contact-methods {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      gap: 20px;
    }

    .contact-method {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--light-text);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .contact-method:hover {
      color: var(--primary-color);
    }

    footer {
      margin-top: 40px;
      padding: 20px;
      font-size: 0.9rem;
      color: var(--gray-text);
      background-color: rgba(0, 0, 0, 0.7);
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .footer-links {
      display: flex;
      gap: 20px;
      margin: 15px 0;
      flex-wrap: wrap;
      justify-content: center;
    }

    .footer-link {
      color: var(--gray-text);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-link:hover {
      color: var(--primary-color);
    }

    .quality-selector {
      margin: 15px 0;
    }

    select {
      padding: 8px 15px;
      border-radius: 5px;
      background-color: var(--darker-bg);
      color: var(--light-text);
      border: 1px solid var(--primary-color);
    }

    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--primary-color);
      color: #000;
      padding: 15px 25px;
      border-radius: 5px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 100;
    }

    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Nouveaux styles pour les fonctionnalités ajoutées */
    .live-chat {
      max-width: 1000px;
      margin: 30px auto;
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
    }

    .live-chat h2 {
      color: var(--primary-color);
      margin-top: 0;
    }

    .chat-messages {
      height: 300px;
      overflow-y: auto;
      margin-bottom: 15px;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 5px;
    }

    .chat-input {
      display: flex;
      gap: 10px;
    }

    .chat-input input {
      flex: 1;
      padding: 10px;
      border-radius: 5px;
      border: none;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .chat-input button {
      padding: 10px 20px;
      background-color: var(--primary-color);
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .poll-container {
      max-width: 1000px;
      margin: 30px auto;
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 10px;
    }

    .poll-container h2 {
      color: var(--primary-color);
      margin-top: 0;
    }

    .poll-option {
      margin: 10px 0;
      padding: 10px;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .poll-option:hover {
      background-color: rgba(0, 255, 204, 0.1);
    }

    .poll-result {
      height: 10px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      margin-top: 5px;
      overflow: hidden;
    }

    .poll-bar {
      height: 100%;
      background-color: var(--primary-color);
      width: 0%;
      transition: width 0.5s ease;
    }

    .theme-selector {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 100;
    }

    .theme-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid white;
      cursor: pointer;
      margin: 5px;
    }

    .theme-dark {
      background: linear-gradient(135deg, #000000, #1a1a1a);
    }

    .theme-light {
      background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
    }

    .theme-brand {
      background: linear-gradient(135deg, #0066cc, #00ffcc);
    }

    .favorite-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      z-index: 5;
    }

    .favorite-btn.active {
      color: gold;
    }

    .news-ticker {
      background-color: rgba(0, 255, 204, 0.1);
      padding: 10px;
      margin: 20px auto;
      max-width: 1000px;
      border-radius: 5px;
      overflow: hidden;
    }

    .ticker-content {
      display: inline-block;
      white-space: nowrap;
      animation: ticker 20s linear infinite;
    }

    @keyframes ticker {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    .subtitles-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      z-index: 5;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.4rem;
      }

      .video-controls {
        flex-direction: column;
        align-items: center;
      }

      .control-btn {
        width: 90%;
        justify-content: center;
      }

      .program-list {
        grid-template-columns: 1fr;
      }

      .theme-selector {
        bottom: 70px;
      }
    }
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <div class="logo-container">
        <img src="https://static.wikia.nocookie.net/logopedia/images/1/18/TM1_TV_Logo.png/revision/latest?cb=20211114122736" alt="Logo TM1" />
      </div>
      <h1>TM1 - TÉLÉVISION MALIENNE 1ÈRE</h1>
      <div class="current-time" id="current-time"></div>
      <div class="current-program" id="current-program">En ce moment: Journal de 20h</div>
    </div>
  </header>

  <main>
    <!-- Bandeau d'actualités -->
    <div class="news-ticker">
      <div class="ticker-content">
        <span style="color: var(--primary-color); font-weight: bold;">ACTUALITÉS : </span>
        <span>Le Président de la République prononcera un discours demain à 10h • </span>
        <span>Match de football en direct ce soir à 21h : Mali vs Sénégal • </span>
        <span>Nouvelle série malienne à ne pas manquer dès lundi prochain • </span>
        <span>Météo: Temps ensoleillé sur Bamako avec 32°C • </span>
        <span>Interview exclusive du ministre de la Culture à 19h30</span>
      </div>
    </div>

    <div id="video-container">
      <button class="favorite-btn" id="favorite-btn" title="Ajouter aux favoris">
        <i class="far fa-star"></i>
      </button>
      <button class="subtitles-btn" id="subtitles-btn" title="Sous-titres">
        <i class="fas fa-closed-captioning"></i>
      </button>
      <div id="loader">Chargement du flux...</div>
     <video id="video" controls autoplay playsinline crossorigin="anonymous"></video>
    </div>

    <div class="video-controls">
      <button class="control-btn" onclick="launchFullscreen()">
        <i class="fas fa-expand"></i> Plein écran
      </button>
      <button class="control-btn secondary" onclick="toggleMute()">
        <i class="fas fa-volume-up" id="volume-icon"></i> Son
      </button>
      <div class="quality-selector">
        <select id="quality-select" onchange="changeQuality(this.value)">
          <option value="auto">Qualité automatique</option>
          <option value="high">Haute qualité</option>
          <option value="medium">Qualité moyenne</option>
          <option value="low">Basse qualité</option>
        </select>
      </div>
      <button class="control-btn secondary" onclick="shareStream()">
        <i class="fas fa-share-alt"></i> Partager
      </button>
      <button class="control-btn secondary" onclick="showAudioOnly()">
        <i class="fas fa-music"></i> Audio seul
      </button>
    </div>

    <!-- Sondage en direct -->
    <div class="poll-container" id="poll-container">
      <h2><i class="fas fa-poll"></i> Sondage en direct</h2>
      <p>Que pensez-vous de notre nouvelle grille de programmes ?</p>
      <div class="poll-option" onclick="votePoll(0)">
        Excellent
        <div class="poll-result"><div class="poll-bar" id="poll-bar-0"></div></div>
      </div>
      <div class="poll-option" onclick="votePoll(1)">
        Bien
        <div class="poll-result"><div class="poll-bar" id="poll-bar-1"></div></div>
      </div>
      <div class="poll-option" onclick="votePoll(2)">
        Moyen
        <div class="poll-result"><div class="poll-bar" id="poll-bar-2"></div></div>
      </div>
      <div class="poll-option" onclick="votePoll(3)">
        À améliorer
        <div class="poll-result"><div class="poll-bar" id="poll-bar-3"></div></div>
      </div>
    </div>

    <!-- Chat en direct -->
    <div class="live-chat">
      <h2><i class="fas fa-comments"></i> Chat en direct</h2>
      <div class="chat-messages" id="chat-messages">
        <!-- Messages seront chargés ici -->
      </div>
      <div class="chat-input">
        <input type="text" id="chat-input" placeholder="Envoyez un message..." />
        <button onclick="sendChatMessage()">Envoyer</button>
      </div>
    </div>

    <div class="program-guide">
      <h2><i class="far fa-calendar-alt"></i> Programme de la journée</h2>
      <div class="program-list" id="program-list">
        <!-- Programme sera chargé dynamiquement -->
      </div>
    </div>

    <div class="socials">
      <h3>Suivez-nous sur les réseaux sociaux</h3>
      <div class="social-links">
        <a href="https://facebook.com/TM1TVMali" class="social-link" target="_blank"><i class="fab fa-facebook-f"></i></a>
        <a href="https://twitter.com/TM1TVMali" class="social-link" target="_blank"><i class="fab fa-twitter"></i></a>
        <a href="https://instagram.com/TM1TVMali" class="social-link" target="_blank"><i class="fab fa-instagram"></i></a>
        <a href="https://youtube.com/TM1TVMali" class="social-link" target="_blank"><i class="fab fa-youtube"></i></a>
        <a href="https://tiktok.com/@TM1TVMali" class="social-link" target="_blank"><i class="fab fa-tiktok"></i></a>
      </div>
    </div>

    <div class="contact-info">
      <h3><i class="fas fa-envelope"></i> Contactez-nous</h3>
      <div class="contact-methods">
        <a href="mailto:contact@tm1.tv" class="contact-method">
          <i class="fas fa-envelope"></i> contact@tm1.tv
        </a>
        <a href="tel:+22320202020" class="contact-method">
          <i class="fas fa-phone"></i> +223 20 20 20 20
        </a>
        <a href="https://wa.me/22320202020" class="contact-method" target="_blank">
          <i class="fab fa-whatsapp"></i> WhatsApp
        </a>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-links">
        <a href="#" class="footer-link">A propos</a>
        <a href="#" class="footer-link">Mentions légales</a>
        <a href="#" class="footer-link">Confidentialité</a>
        <a href="#" class="footer-link">Publicité</a>
        <a href="#" class="footer-link">Recrutement</a>
      </div>
      <p>© 2025 TM1 Télévision | Tous droits réservés</p>
      <p>Chaîne nationale de la République du Mali</p>
    </div>
  </footer>

  <div class="theme-selector">
    <button class="theme-btn theme-dark" onclick="changeTheme('dark')" title="Thème sombre"></button>
    <button class="theme-btn theme-light" onclick="changeTheme('light')" title="Thème clair"></button>
    <button class="theme-btn theme-brand" onclick="changeTheme('brand')" title="Thème TM1"></button>
  </div>

  <div class="notification" id="notification"></div>

  <!-- HLS.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
  // Configuration mise à jour
  const video = document.getElementById('video');
  const loader = document.getElementById('loader');
  
  // 1. Essayer d'abord avec HTTPS
  let videoSrc = 'https://69.64.57.208/tm1/playlist.m3u8';
  
  // 2. Fallback avec proxy CORS si HTTPS échoue
  const fallbackSrc = 'https://cors-anywhere.herokuapp.com/http://69.64.57.208/tm1/playlist.m3u8';
  
  // 3. Détection de protocole
  if (window.location.protocol === 'https:' && !videoSrc.startsWith('https')) {
    videoSrc = fallbackSrc;
  }

  loader.style.display = 'block';

  if (Hls.isSupported()) {
    const hls = new Hls({
      enableWorker: false, // Important pour certains environnements
      xhrSetup: function(xhr) {
        xhr.withCredentials = false;
      }
    });
    
    hls.loadSource(videoSrc);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, function() {
      loader.style.display = 'none';
      video.play().catch(e => {
        console.error("Erreur de lecture:", e);
        // Essayer avec le fallback
        if (videoSrc !== fallbackSrc) {
          showNotification("Tentative de connexion alternative...");
          videoSrc = fallbackSrc;
          hls.loadSource(videoSrc);
        }
      });
    });
    
    hls.on(Hls.Events.ERROR, function(event, data) {
      if (data.fatal) {
        switch(data.type) {
          case Hls.ErrorTypes.NETWORK_ERROR:
            showNotification("Erreur réseau - reconnexion...");
            hls.startLoad();
            break;
          case Hls.ErrorTypes.MEDIA_ERROR:
            hls.recoverMediaError();
            break;
          default:
            initPlayer();
            break;
        }
      }
    });
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = videoSrc;
    video.addEventListener('loadedmetadata', function() {
      loader.style.display = 'none';
      video.play();
    });
  } else {
    loader.innerHTML = "Votre navigateur ne supporte pas la lecture HLS. Essayez avec Safari ou Edge.";
  }
</script>
  <script>
    // Configuration initiale
    const video = document.getElementById('video');
    const loader = document.getElementById('loader');
    const notification = document.getElementById('notification');
    const volumeIcon = document.getElementById('volume-icon');
    const currentTimeElement = document.getElementById('current-time');
    const currentProgramElement = document.getElementById('current-program');
    const programListElement = document.getElementById('program-list');
    const favoriteBtn = document.getElementById('favorite-btn');
    const subtitlesBtn = document.getElementById('subtitles-btn');
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const pollContainer = document.getElementById('poll-container');
    
    // Sources de flux avec différentes qualités
    const videoSources = {
      auto: 'http://69.64.57.208/tm1/playlist.m3u8',
      high: 'http://69.64.57.208/tm1/high/playlist.m3u8',
      medium: 'http://69.64.57.208/tm1/medium/playlist.m3u8',
      low: 'http://69.64.57.208/tm1/low/playlist.m3u8'
    };
    
    let hls;
    let isMuted = false;
    let isFavorite = false;
    let subtitlesEnabled = false;
    let audioOnlyMode = false;
    let pollResults = [0, 0, 0, 0]; // Résultats du sondage
    let hasVoted = false;

    // Initialiser le lecteur
    function initPlayer(quality = 'auto') {
      loader.style.display = 'block';
      
      if (hls) {
        hls.destroy();
      }

      if (Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(videoSources[quality]);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          loader.style.display = 'none';
          video.play().catch(e => {
            showNotification('Cliquez sur le lecteur pour démarrer la lecture');
          });
        });
        hls.on(Hls.Events.ERROR, function (event, data) {
          if (data.fatal) {
            switch(data.type) {
              case Hls.ErrorTypes.NETWORK_ERROR:
                showNotification('Erreur réseau. Tentative de reconnexion...');
                hls.startLoad();
                break;
              case Hls.ErrorTypes.MEDIA_ERROR:
                showNotification('Erreur média. Rechargement...');
                hls.recoverMediaError();
                break;
              default:
                initPlayer();
                break;
            }
          }
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = videoSources[quality];
        video.addEventListener('loadedmetadata', () => {
          loader.style.display = 'none';
          video.play().catch(e => {
            showNotification('Cliquez sur le lecteur pour démarrer la lecture');
          });
        });
      } else {
        loader.innerText = "Votre navigateur ne supporte pas ce type de flux.";
      }
    }

    // 1. Changer la qualité vidéo
    function changeQuality(quality) {
      showNotification(`Changement vers ${quality === 'auto' ? 'qualité automatique' : quality + ' qualité'}`);
      initPlayer(quality);
    }

    // 2. Plein écran
    function launchFullscreen() {
      if (video.requestFullscreen) {
        video.requestFullscreen();
      } else if (video.webkitRequestFullscreen) {
        video.webkitRequestFullscreen();
      } else if (video.msRequestFullscreen) {
        video.msRequestFullscreen();
      }
    }

    // 3. Basculer le son
    function toggleMute() {
      isMuted = !isMuted;
      video.muted = isMuted;
      volumeIcon.className = isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
      showNotification(isMuted ? 'Son désactivé' : 'Son activé');
    }

    // 4. Partager le flux
    function shareStream() {
      if (navigator.share) {
        navigator.share({
          title: 'Regardez TM1 en direct',
          text: 'Suivez la chaîne nationale malienne en streaming live',
          url: window.location.href
        }).catch(err => {
          console.log('Erreur de partage:', err);
        });
      } else {
        // Fallback pour les navigateurs sans support de l'API Share
        const shareUrl = window.location.href;
        navigator.clipboard.writeText(shareUrl).then(() => {
          showNotification('Lien copié dans le presse-papier');
        });
      }
    }

    // 5. Mode audio seul
    function showAudioOnly() {
      audioOnlyMode = !audioOnlyMode;
      if (audioOnlyMode) {
        video.style.opacity = '0';
        video.style.position = 'absolute';
        showNotification('Mode audio seul activé');
      } else {
        video.style.opacity = '1';
        video.style.position = 'relative';
        showNotification('Mode audio seul désactivé');
      }
    }

    // 6. Sous-titres (simulés)
    function toggleSubtitles() {
      subtitlesEnabled = !subtitlesEnabled;
      if (subtitlesEnabled) {
        // En production, vous utiliseriez des fichiers WebVTT réels
        showNotification('Sous-titres activés (simulation)');
        subtitlesBtn.innerHTML = '<i class="fas fa-closed-captioning"></i> ON';
      } else {
        showNotification('Sous-titres désactivés');
        subtitlesBtn.innerHTML = '<i class="fas fa-closed-captioning"></i> OFF';
      }
    }

    // 7. Ajouter aux favoris
    function toggleFavorite() {
      isFavorite = !isFavorite;
      if (isFavorite) {
        favoriteBtn.innerHTML = '<i class="fas fa-star"></i>';
        favoriteBtn.title = 'Retirer des favoris';
        showNotification('Chaîne ajoutée aux favoris');
        // Enregistrer dans localStorage
        localStorage.setItem('tm1_favorite', 'true');
      } else {
        favoriteBtn.innerHTML = '<i class="far fa-star"></i>';
        favoriteBtn.title = 'Ajouter aux favoris';
        showNotification('Chaîne retirée des favoris');
        localStorage.removeItem('tm1_favorite');
      }
    }

    // 8. Chat en direct (simulé)
    function sendChatMessage() {
      const message = chatInput.value.trim();
      if (message) {
        const now = new Date();
        const timeString = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
        
        const messageElement = document.createElement('div');
        messageElement.innerHTML = `<strong>Vous (${timeString}):</strong> ${message}`;
        chatMessages.appendChild(messageElement);
        
        // Faire défiler vers le bas
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Effacer le champ de saisie
        chatInput.value = '';
        
        // Simuler une réponse
        setTimeout(() => {
          const responses = [
            "Merci pour votre message!",
            "Nous transmettons votre commentaire à l'équipe!",
            "Excellent point de vue!",
            "Merci de suivre TM1!",
            "Votre message a été noté!"
          ];
          const randomResponse = responses[Math.floor(Math.random() * responses.length)];
          
          const responseElement = document.createElement('div');
          responseElement.innerHTML = `<strong>Modérateur (${timeString}):</strong> ${randomResponse}`;
          responseElement.style.color = '#00ffcc';
          chatMessages.appendChild(responseElement);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }, 2000);
      }
    }

    // 9. Sondage en direct
    function votePoll(option) {
      if (hasVoted) {
        showNotification('Vous avez déjà voté!');
        return;
      }
      
      pollResults[option]++;
      hasVoted = true;
      
      // Calculer les pourcentages
      const total = pollResults.reduce((a, b) => a + b, 0);
      const percentages = pollResults.map(v => Math.round((v / total) * 100));
      
      // Mettre à jour les barres
      for (let i = 0; i < 4; i++) {
        document.getElementById(`poll-bar-${i}`).style.width = `${percentages[i]}%`;
      }
      
      showNotification('Merci pour votre vote!');
    }

    // 10. Changer le thème
    function changeTheme(theme) {
      const root = document.documentElement;
      
      if (theme === 'light') {
        root.style.setProperty('--dark-bg', '#f5f5f5');
        root.style.setProperty('--darker-bg', '#e0e0e0');
        root.style.setProperty('--light-text', '#333333');
        root.style.setProperty('--gray-text', '#666666');
      } else if (theme === 'brand') {
        root.style.setProperty('--dark-bg', '#0066cc');
        root.style.setProperty('--darker-bg', '#003366');
        root.style.setProperty('--primary-color', '#ffffff');
        root.style.setProperty('--light-text', '#ffffff');
        root.style.setProperty('--gray-text', '#cccccc');
      } else { // dark (par défaut)
        root.style.setProperty('--dark-bg', '#000000');
        root.style.setProperty('--darker-bg', '#1a1a1a');
        root.style.setProperty('--primary-color', '#00ffcc');
        root.style.setProperty('--light-text', '#ffffff');
        root.style.setProperty('--gray-text', '#aaaaaa');
      }
      
      localStorage.setItem('tm1_theme', theme);
      showNotification(`Thème ${theme} activé`);
    }

    // Afficher une notification
    function showNotification(message) {
      notification.textContent = message;
      notification.classList.add('show');
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Mettre à jour l'heure actuelle
    function updateCurrentTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
      const dateString = now.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' });
      currentTimeElement.textContent = `${dateString} - ${timeString}`;
    }

    // Simuler un programme TV (à remplacer par des données réelles)
    function loadProgramGuide() {
      const programs = [
        { time: '06:00', title: 'Matinée Malienne', description: 'Émission matinale avec infos et divertissement' },
        { time: '08:30', title: 'Journal Matinal', description: 'Actualités nationales et internationales' },
        { time: '12:00', title: 'TM1 Midi', description: 'Journal de mi-journée' },
        { time: '14:00', title: 'Série Africaine', description: 'Série dramatique populaire' },
        { time: '16:00', title: 'Magazine Culturel', description: 'Découverte du patrimoine malien' },
        { time: '18:00', title: 'Journal TM1', description: 'Actualités du soir' },
        { time: '20:00', title: 'Débat National', description: 'Discussion sur les sujets d\'actualité' },
        { time: '22:00', title: 'Film du Soir', description: 'Long métrage africain' }
      ];

      let programHtml = '';
      programs.forEach(program => {
        programHtml += `
          <div class="program-item">
            <div class="program-time">${program.time}</div>
            <div class="program-title">${program.title}</div>
            <div class="program-desc">${program.description}</div>
          </div>
        `;
      });

      programListElement.innerHTML = programHtml;
    }

    // Initialiser la page
    window.onload = function() {
      initPlayer();
      updateCurrentTime();
      setInterval(updateCurrentTime, 1000);
      loadProgramGuide();
      
      // Vérifier le thème sauvegardé
      const savedTheme = localStorage.getItem('tm1_theme') || 'dark';
      changeTheme(savedTheme);
      
      // Vérifier les favoris
      if (localStorage.getItem('tm1_favorite') === 'true') {
        toggleFavorite(); // Active l'état favori
      }
      
      // Écouteurs d'événements
      favoriteBtn.addEventListener('click', toggleFavorite);
      subtitlesBtn.addEventListener('click', toggleSubtitles);
      
      // Permettre d'envoyer un message avec Enter
      chatInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendChatMessage();
        }
      });
      
      // Mettre à jour le programme actuel (simulation)
      setInterval(() => {
        const programs = [
          'Journal Matinal',
          'Série Africaine',
          'Magazine Culturel',
          'Journal TM1',
          'Débat National',
          'Film du Soir'
        ];
        const randomProgram = programs[Math.floor(Math.random() * programs.length)];
        currentProgramElement.textContent = `En ce moment: ${randomProgram}`;
      }, 10000);
      
      // Simuler quelques messages de chat initiaux
      setTimeout(() => {
        const initialMessages = [
          { sender: 'Modérateur', message: 'Bienvenue sur le chat de TM1!', color: '#00ffcc' },
          { sender: 'Fatoumata', message: 'Super émission ce matin!', color: '' },
          { sender: 'Modérateur', message: 'Merci Fatoumata!', color: '#00ffcc' },
          { sender: 'Amadou', message: 'Quand est-ce que le match sera diffusé?', color: '' }
        ];
        
        initialMessages.forEach(msg => {
          const now = new Date();
          const timeString = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
          const messageElement = document.createElement('div');
          messageElement.innerHTML = `<strong>${msg.sender} (${timeString}):</strong> ${msg.message}`;
          if (msg.color) {
            messageElement.style.color = msg.color;
          }
          chatMessages.appendChild(messageElement);
        });
        
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }, 1000);
    };

    // Gestionnaire d'erreur pour le lecteur vidéo
    video.addEventListener('error', () => {
      showNotification('Erreur de lecture. Reconnexion en cours...');
      setTimeout(() => {
        initPlayer();
      }, 3000);
    });
  </script>
</body>
</html>
